<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />

	<title>$.browserEvent() jQuery plugin</title>
	<meta name="title" content="windowSync() jQuery plugin" />
	<meta name="description" content="Keeping data in multiple browser windows in sync." />
	
	<link rel="stylesheet" type="text/css" href="screen.css" />
	<script type="text/javascript" src="json2.js"></script>
	<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="jquery.store.js"></script>
	<script type="text/javascript" src="jquery.browserEvent.js"></script>
	<script type="text/javascript">
		(function($,undefined){

			// initialize storage
			$.storage = new $.store();
			$.storageWindow = new $.store( 'windowName' );
			
			var $windows = null,
				$windowList = null,
				$messages = null,
				$messageList = null,
				shorten = function( win ){ return 'win' + win.substr( 13 ) };
			
			var handle = {
				windowUpdate: function( e, data, ident )
				{
					$windowList.empty();
					$.each( data, function( win, time )
					{
						var $t = $( '<li></li>' )
							.text( shorten(win) )
							.appendTo( $windowList )
							.data( 'be', win )
							.bind( 'click', handle.sendMessage );
						
						if( win === ident )
							$t.addClass( 'self' );
					});
					
					$( '<li class="info">broadcast</li>' ).appendTo( $windowList ).bind( 'click', handle.sendMessage );
				},
				message: function( e, data, origin )
				{
					var $t = $( '<li></li>' ).prependTo( $messageList );
					$( '<span class="ident"></span>' ).text( origin === "self" ? 'I sent' : shorten(origin) ).appendTo( $t );
					$( '<span class="message"></span>' ).text( data ).appendTo( $t );

					if( origin == 'self' )
						$t.addClass( 'self' );

					$( '<div class="clear"></div>' ).appendTo( $t );
				},
				ready: function()
				{
					$( '<li class="info">ready for business…</li>' ).prependTo( $messageList );
				},
				
				sendMessage: function()
				{
					var ident = $(this).data( 'be' );
					$.browserEvent.trigger( 'message', 'Hello, how are you?', ident );
				}
			};
			
			$(function()
			{
				$windows = $( '#windows' );
				$windowList = $( '#windows > ul' );
				
				$messages = $( '#messages' );
				$messageList = $( '#messages > ul' );
				$.browserEvent.ready = handle.ready;
				$.browserEvent
					.bind( 'browserWindows', handle.windowUpdate )
					.bind( 'message', handle.message )
					.init( $.storage, $.storageWindow );
			
			});
			
		})(jQuery);
		
	</script>
</head>
<body>
	
	<h1>$.browserEvent() Demo</h1>
	<div id="wrapper">
	<div id="windows">
		<h2>Registered Windows</h2>
		<ul>
			<li>Initializing…</li>
		</ul>
	</div>
	
	<div id="messages">
		<h2>Messages</h2>
		<ul>
			<li class="info">Initializing…</li>
		</ul>
	</div>
	</div>
</body>
</html>